# Часть 1 (Intro)
Распределенные системы - это ключевой компонент современных сервисов. Написание корректный код очень сложно. Надо учитывать мн-во факторов, которые могут влиять на нашу систему (потеря сообщений, отказ нод и т.д.). Разработчики хотят решение, которое будет проверять св-ва алгоритма и выдавать фидбек.

В современном мире используются несколько стандартных техник для верефикации систем:
1) Стандартное тестирование - разработчики пишут мн-во тестов, которые новый код должен пройти, прежде чем его добавят в кодовую базу. Этот метод не подходит для распределенных систем, так как мн-во факторов из внешнего мира может влиять на систему, а моделировать это с помощью стандартных тестов невозможно.
2) Код ревью - после прохождения всех рукописных тестов разработчики пытаются найти баги с помощью просмотра нового кода. Это слишком дорого и требует больших затрат.

В противопоставление этим методам ученые придумали способ тестирования - это model checking. Для начала надо вести граф конфигураций нашей системы:
* Вершины - это внутреннее состояние всех нод, состояние сети.
* Ребра - ребра образуются в результате доставки сообщения от одно из нод другой.

Система/алгоритм описывается с математическим языком и model checker исследует все возможные выполнения системы (траектории в графе конфигураций) и проверяет св-ва.

Одной из самых популярных реализаций такого подхода является язык TLA+ и model checker для него.

Язык формальной верификации - это формальная система, которая фокусируется на том, что должна делать программа, а не как (в отличие от языков программирования).

IT лидеры рассказали, что они использую TLA для валидации их систем. Amazon с помощью TLA верифицировал свои основные системы и поделился результатом в [статье](https://lamport.azurewebsites.net/tla/formal-methods-amazon.pdf). В которой подробно описывается опыт инженеров Amazon, которые используют TLA для проектирования систем.

![result](res.png)

Первая часть работы будет состоять из сравнения и выявления общих св-в у существующих спеках

Примеры:
* Kafka
* Snapshot Isolation
* Paxos
* Raft
* Percolator

Вторая часть работы будет состоять из применения выявленных особенностей на ClickHouse.

ClickHouse - это колоночная распределенная БД. В КХ есть тип движка таблиц, который реплицируются между несколькими репликами. Для процесса репликации ClickHouse использует ZooKeeper. В ZK хранится реплицированный лог с информациями о вставках, znode для кворума и многое другое.

Основная задача состоит в формальном описании алгоритма репликации КХ и в проверке правильности алгоритмов для обрезки лога в ZooKeeper и для кворумных вставок и чтений в КХ.
